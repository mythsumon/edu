# 출적비 및 강사비 비즈니스 로직

## 개요

본 문서는 강사 정산 시스템의 출적비(출장비)와 강사비 계산에 대한 비즈니스 로직과 운영 흐름을 설명합니다.

---

## 메뉴 구조

### 관리자 메뉴 위치
- **시스템 관리** > **출장 정산** (`/admin/settlements/travel`)
- **시스템 관리** > **강사 정산** (`/admin/settlements/instructor`)

### 접근 권한
- 관리자(ADMIN) 권한 필요

---

## 1. 출적비 (Travel Allowance) 비즈니스 로직

### 1.1 출적비 계산 개요

출적비는 강사가 집에서 출발하여 교육 기관을 방문하고 다시 집으로 돌아오는 일일 이동 거리를 기준으로 계산됩니다.

### 1.2 계산 방식

#### 거리 계산 원칙
- **31개 시군 간 고정 거리표** 사용 (시청-시청 간 거리)
- 같은 시군 내 이동: **0km**
- 일일 단위 계산 (강사별, 날짜별)
- 하루에 여러 기관 방문 시: **집 → 기관1 → 기관2 → ... → 집** 경로로 계산

#### 거리 구간별 출적비 금액

| 이동 거리 | 출적비 금액 |
|---------|-----------|
| 0 ~ 50km 미만 | 0원 |
| 50km 이상 ~ 70km 미만 | 20,000원 |
| 70km 이상 ~ 90km 미만 | 30,000원 |
| 90km 이상 ~ 110km 미만 | 40,000원 |
| 110km 이상 ~ 130km 미만 | 50,000원 |
| 130km 이상 | 60,000원 |

### 1.3 출적비 계산 시나리오

#### 시나리오 1: 같은 시군 내 교육
- 강사 거주지: 수원시
- 교육 기관: 수원시
- **결과**: 이동거리 0km → 출적비 0원

#### 시나리오 2: 하루에 여러 기관 방문
- 강사 거주지: 용인시
- 날짜: 2025-01-15
  - 오전: 성남시 기관 A
  - 오후: 수원시 기관 B
- **경로**: 용인 → 성남 → 수원 → 용인
- **결과**: 각 구간 거리 합산 → 총 거리에 따른 출적비 지급

#### 시나리오 3: 거리 구간 경계
- 총 이동거리: 89.9km → 20,000원 (70~90km 구간)
- 총 이동거리: 90.0km → 30,000원 (90~110km 구간)

### 1.4 출적비 관리 흐름

```
1. 강사 배정 완료
   ↓
2. 일일 출장 기록 자동 생성
   - 강사별, 날짜별로 그룹화
   - 경로 자동 계산 (집 → 기관1 → 기관2 → ... → 집)
   ↓
3. 거리 계산 및 정책 적용
   - 31개 시군 거리표 기준
   - 거리 구간별 금액 자동 적용
   ↓
4. 월별 집계
   - 강사별로 월 전체 출적비 합계
   ↓
5. 정산 확인 및 지급
```

### 1.5 출적비 데이터 관리

#### 필수 정보
- 강사 거주지 주소 및 좌표 (위도/경도)
- 교육 기관 주소 및 좌표 (위도/경도)
- 교육 일정 (날짜, 시간)

#### 상태 관리
- **DRAFT**: 주소/좌표 미입력 등으로 자동 계산 불가
- **FINAL**: 정상 계산 완료

---

## 2. 강사비 (Teaching Fee) 비즈니스 로직

### 2.1 강사비 계산 개요

강사비는 기본 강사료와 각종 수당을 합산하여 계산됩니다. 차시(수업 횟수) 단위로 계산되며, 여러 수당이 중복 적용될 수 있습니다.

### 2.2 기본 강사료 (Base Fee)

#### 역할별, 학교급별 단가

**주강사 (Main Instructor)**
- 초등학교: 차시당 40,000원
- 중학교: 차시당 45,000원
- 고등학교: 차시당 50,000원

**보조강사 (Assistant Instructor)**
- 초등학교: 차시당 30,000원
- 중학교: 차시당 35,000원
- 고등학교: 차시당 40,000원

### 2.3 추가 수당 (Allowances)

#### 차시별 수당 (차시당 금액)

1. **도서·벽지 수당**
   - 금액: 차시당 +5,000원
   - 적용 조건: 도서벽지 지역 기관
   - 중복 적용: 가능

2. **특수 수당**
   - 금액: 차시당 +10,000원
   - 적용 조건: 특수학교 또는 특수학급
   - 중복 적용: 가능

3. **주말 수당**
   - 금액: 차시당 +5,000원
   - 적용 조건: 토요일 또는 일요일 수업
   - 예외: 행사 참여 시 제외
   - 중복 적용: 가능

4. **15명 이상 보조강사 없음 수당**
   - 금액: 차시당 +5,000원
   - 적용 조건: 
     - 학생 수 15명 이상
     - 보조강사 미배정
     - 주강사에게만 적용
   - 중복 적용: 가능

5. **중등부 수당**
   - 금액: 차시당 +5,000원
   - 적용 조건: 중학교
   - 중복 적용: 가능

6. **고등부 수당**
   - 금액: 차시당 +10,000원
   - 적용 조건: 고등학교
   - 중복 적용: 가능

#### 일별 수당

7. **교구 운반 수당**
   - 금액: 일당 20,000원
   - 적용 조건: 교구 운반이 필요한 날
   - 월 한도: 강사당 월 최대 300,000원
   - 중복 적용: 하루에 여러 번 운반해도 일당 20,000원만 지급

#### 시간별 수당

8. **행사 참여 수당**
   - 금액: 시간당 25,000원
   - 적용 조건: 행사 참여 활동
   - 주의: 행사 참여 시 주말 수당 미적용

9. **멘토링 수당 (역량강화)**
   - 방법 A: 차시당 10,000원
   - 방법 B: 시간당 40,000원 (하루 최대 3시간, 일 1회)
   - 적용 조건: 멘토링 활동

### 2.4 강사비 계산 예시

#### 예시 1: 기본 수업
- 역할: 주강사
- 학교급: 초등학교
- 차시: 2차시
- **기본 강사료**: 2 × 40,000 = 80,000원

#### 예시 2: 수당 중복 적용
- 역할: 주강사
- 학교급: 초등학교
- 차시: 2차시
- 조건: 도서벽지 + 특수 + 주말 + 학생 20명(보조강사 없음)
- **계산**:
  - 기본 강사료: 2 × 40,000 = 80,000원
  - 도서벽지: 2 × 5,000 = 10,000원
  - 특수: 2 × 10,000 = 20,000원
  - 주말: 2 × 5,000 = 10,000원
  - 보조강사 없음: 2 × 5,000 = 10,000원
  - **합계**: 130,000원

#### 예시 3: 교구 운반 수당
- 역할: 주강사
- 기본 강사료: 80,000원
- 교구 운반 일수: 5일
- **교구 운반 수당**: 5 × 20,000 = 100,000원
- **합계**: 180,000원

#### 예시 4: 행사 참여
- 행사 참여 시간: 3시간
- **행사 참여 수당**: 3 × 25,000 = 75,000원
- 주의: 주말이어도 주말 수당 미적용

### 2.5 취소 수업 처리

- **상태가 "취소(CANCELLED)"인 수업**:
  - 기본 강사료 계산에서 제외
  - 별도로 취소 내역 표시
  - 출적비는 정상 계산 (배정된 경우)

### 2.6 강사비 관리 흐름

```
1. 교육 배정 및 강사 배정 완료
   ↓
2. 일별 활동 데이터 수집
   - 수업 차시, 행사 시간, 교구 운반 여부 등
   ↓
3. 일별 정산 계산
   ├─ 기본 강사료 (차시 × 단가)
   ├─ 차시별 수당 계산
   │  ├─ 도서벽지 (+5,000원/차시)
   │  ├─ 특수 (+10,000원/차시)
   │  ├─ 주말 (+5,000원/차시)
   │  └─ 15명+보조없음 (+5,000원/차시)
   ├─ 일별 수당
   │  └─ 교구운반 (+20,000원/일)
   └─ 시간별 수당
      ├─ 행사참여 (시간 × 25,000원)
      └─ 멘토링 (차시 × 10,000원 또는 시간 × 40,000원)
   ↓
4. 월별 집계
   ├─ 일별 정산 합계
   ├─ 교구운반 캡 적용 (최대 300,000원)
   ├─ 총액 계산
   ├─ 세금 계산 (3.3%)
   └─ 실지급액 계산
   ↓
5. 정산 확인 및 지급
```

---

## 3. 통합 정산 흐름

### 3.1 월별 정산 프로세스

#### 단계 1: 데이터 준비
- 강사별 교육 배정 내역
- 강사 거주지 정보
- 교육 기관 정보
- 일별 활동 내역

#### 단계 2: 일별 정산 계산
각 강사의 일별 정산 항목:
1. **기본 강사료**: 차시 × 역할별 단가
2. **차시별 수당**: 도서벽지, 특수, 주말, 보조강사 없음 등
3. **일별 수당**: 교구 운반
4. **시간별 수당**: 행사 참여, 멘토링
5. **출적비**: 일일 이동 거리 기준

#### 단계 3: 월별 집계
- 강사별로 월 전체 일별 정산 합계
- 교구 운반 수당 월 한도 적용 (최대 300,000원)
- 총액 계산
- 세금 계산 (3.3% 사업소득세)
- 실지급액 계산

#### 단계 4: 정산 확인
- 일별 정산 상세 내역 확인
- 월별 정산 요약 확인
- 데이터 내보내기 (JSON, CSV)

### 3.2 정산 확인 화면 구성

#### 일별 정산 테이블
- 강사명, 날짜, 차시 수, 기본 강사료, 수당 합계, 출적비, 일일 합계
- 행 클릭 시 상세 내역 표시:
  - 수업별 계산 상세
  - 출장 경로 및 거리
  - 각종 수당 내역

#### 월별 정산 요약 테이블
- 강사명, 총 일수, 총 차시, 기본 강사료, 수당 합계, 교구운반, 행사, 출적비
- 총액, 세금(3.3%), 실지급액

---

## 4. 비즈니스 규칙 요약

### 4.1 출적비 규칙
- ✅ 일일 단위 계산 (강사별, 날짜별)
- ✅ 하루 여러 기관 방문 시 경로 합산
- ✅ 같은 시군 내 이동 = 0km
- ✅ 거리 구간별 고정 금액
- ✅ 주소/좌표 미입력 시 DRAFT 상태

### 4.2 강사비 규칙
- ✅ 차시 단위 계산
- ✅ 여러 수당 중복 적용 가능
- ✅ 취소 수업은 기본 강사료 제외
- ✅ 교구 운반 수당 월 한도 적용 (300,000원)
- ✅ 행사 참여 시 주말 수당 미적용
- ✅ 15명 이상 보조강사 없음 수당은 주강사만

### 4.3 세금 계산
- 사업소득세: 3.3% (지방소득세 포함)
- 총액에서 세금 공제 후 실지급액 계산

---

## 5. 메뉴별 기능

### 5.1 출장 정산 (`/admin/settlements/travel`)
- 강사별 일일 출장 기록 조회
- 출장 경로 및 거리 확인
- 출적비 자동 계산 및 확인
- 월별 출장비 집계

### 5.2 강사 정산 (`/admin/settlements/instructor`)
- 강사별 일별 정산 상세 조회
- 강사별 월별 정산 요약 조회
- 기본 강사료 및 각종 수당 계산 내역 확인
- 출적비 포함 통합 정산 확인
- 정산 데이터 내보내기 (JSON, CSV)

---

## 6. 데이터 요구사항

### 6.1 출적비 계산 필수 데이터
- 강사 거주지 주소 및 좌표 (위도/경도)
- 교육 기관 주소 및 좌표 (위도/경도)
- 교육 일정 (날짜, 시간)
- 강사-교육 배정 정보

### 6.2 강사비 계산 필수 데이터
- 강사 역할 (주강사/보조강사)
- 학교급 (초등/중등/고등)
- 차시 수
- 기관 특성 (도서벽지 여부, 특수 여부)
- 학생 수
- 보조강사 배정 여부
- 수업 날짜 (주말 여부 판단)
- 교구 운반 여부
- 행사 참여 시간
- 멘토링 차시/시간

---

## 7. 예외 처리 및 특수 케이스

### 7.1 출적비 예외
- 주소/좌표 미입력: DRAFT 상태로 표시, 수동 입력 필요
- 거리 50km 미만: 출적비 0원
- 같은 시군 내 이동: 거리 0km, 출적비 0원

### 7.2 강사비 예외
- 취소 수업: 기본 강사료 제외, 별도 표시
- 행사 참여: 주말 수당 미적용
- 교구 운반: 하루 여러 번 해도 일당 20,000원만, 월 최대 300,000원
- 멘토링: 시간당 방식 시 하루 최대 3시간

---

## 8. 정산 확인 체크리스트

### 관리자 확인 사항
- [ ] 강사별 일별 정산 내역 확인
- [ ] 출적비 거리 및 금액 확인
- [ ] 각종 수당 적용 여부 확인
- [ ] 교구 운반 수당 월 한도 확인
- [ ] 취소 수업 제외 여부 확인
- [ ] 월별 정산 합계 확인
- [ ] 세금 계산 확인
- [ ] 실지급액 확인

---

## 9. 참고 사항

### 9.1 계산 기준일
- 정산 월 기준으로 해당 월의 모든 교육 활동 포함
- 일별 정산은 교육 날짜 기준

### 9.2 데이터 정합성
- 출적비와 강사비는 별도 계산 후 합산
- 일별 정산 합계 = 월별 정산 합계 검증 필요

### 9.3 정산 주기
- 월별 정산 (매월 말일 기준)
- 일별 정산은 실시간 확인 가능

---

**작성일**: 2025-01-XX  
**버전**: 1.0  
**담당**: PM
